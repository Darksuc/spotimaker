<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <title>Spotimaker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <style>
        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0b0b0e;
            color: #fff;
        }

        header {
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,.08);
        }

        .spotify-badge {
            padding: 6px 10px;
            border-radius: 999px;
            font-size: 13px;
        }

        .actions a {
            margin-left: 12px;
            color: #22c55e;
            text-decoration: none;
            cursor: pointer;
        }

            .actions a.hidden {
                display: none;
            }

        .container {
            padding: 24px;
            max-width: 700px;
            margin: auto;
        }

        .plan {
            margin-bottom: 16px;
            font-size: 14px;
            opacity: .9;
        }

        .premium-badge {
            display: none;
            background: rgba(234,179,8,.25);
            padding: 6px 10px;
            border-radius: 8px;
            margin-left: 8px;
            font-size: 12px;
        }

        input[type="range"] {
            width: 100%;
        }

        .hint {
            margin-top: 6px;
            font-size: 13px;
            opacity: .7;
        }

        button {
            margin-top: 16px;
            padding: 12px;
            width: 100%;
            border-radius: 8px;
            border: none;
            background: #22c55e;
            color: #000;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <header>
        <div id="spotifyStatus" class="spotify-badge">Spotify bağlı değil</div>

        <div class="actions">
            <a id="spotifyLink" href="/login">Spotify bağla</a>
            <a id="logoutLink" href="/logout" class="hidden">Çıkış yap</a>
        </div>
    </header>

    <div class="container">

        <div class="plan">
            Plan: <strong id="planText">FREE</strong>
            <span id="premiumBadge" class="premium-badge">PREMIUM</span>
        </div>

        <label>
            Şarkı sayısı:
            <input id="countInput" type="range" min="20" max="40" step="5" value="40" />
        </label>

        <div id="countHint" class="hint"></div>

        <button id="generateBtn">Playlist oluştur</button>
    </div>

    <script>
        const spotifyStatus = document.getElementById("spotifyStatus");
        const spotifyLink = document.getElementById("spotifyLink");
        const logoutLink = document.getElementById("logoutLink");

        const planText = document.getElementById("planText");
        const premiumBadge = document.getElementById("premiumBadge");

        const countInput = document.getElementById("countInput");
        const countHint = document.getElementById("countHint");
        const generateBtn = document.getElementById("generateBtn");

        let __isPremium = false;

        function applyPlanUI() {
            if (__isPremium) {
                planText.textContent = "PREMIUM";
                premiumBadge.style.display = "inline-block";
                countInput.max = 200;
                if (Number(countInput.value) < 40) countInput.value = 40;
            } else {
                planText.textContent = "FREE";
                premiumBadge.style.display = "none";
                countInput.max = 40;
                if (Number(countInput.value) > 40) countInput.value = 40;
            }
            updateCountHint();
        }

        function updateCountHint() {
            if (__isPremium) {
                countHint.textContent = `${countInput.value} şarkı seçilecek (Premium)`;
            } else {
                countHint.textContent = `${countInput.value} şarkı seçilecek (Free limit)`;
            }
        }

        countInput.addEventListener("input", updateCountHint);

        async function refreshSpotifyStatus() {
            try {
                const r = await fetch("/api/me", { credentials: "include" });
                const j = await r.json();

                if (j && j.ok && j.me) {
                    __isPremium = Boolean(j.premium);

                    spotifyStatus.textContent = "Spotify bağlı: " + (j.me.display_name || "OK");
                    spotifyStatus.style.background = "rgba(34,197,94,.20)";
                    spotifyStatus.style.color = "#fff";

                    spotifyLink.textContent = "Hesap değiştir";
                    spotifyLink.href = "/switch-account";

                    logoutLink.classList.remove("hidden");

                    applyPlanUI();
                } else {
                    __isPremium = false;

                    spotifyStatus.textContent = "Spotify bağlı değil";
                    spotifyStatus.style.background = "rgba(255,255,255,.08)";
                    spotifyStatus.style.color = "rgba(255,255,255,.72)";

                    spotifyLink.textContent = "Spotify bağla";
                    spotifyLink.href = "/login";

                    logoutLink.classList.add("hidden");

                    applyPlanUI();
                }
            } catch (e) {
                console.error("refreshSpotifyStatus error", e);
            }
        }

        generateBtn.addEventListener("click", () => {
            alert("Playlist oluşturma burada devam edecek.");
        });

        window.addEventListener("load", () => {
            applyPlanUI();
            refreshSpotifyStatus();
        });
    </script>

</body>
</html>
